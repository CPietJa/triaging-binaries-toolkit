# Variables
EXE=tbt

# Usual compilation flags
CFLAGS=-std=c11 -Wall -Wextra -g -O2 -march=native
CPPFLAGS=-I../include -DDEBUG
LDFLAGS=-lm

LIBELF_DIR=../include/libelf
LIBELF=$(LIBELF_DIR)/libelf.a $(LIBELF_DIR)/libbele/libbele.a

# Special rules and targets
.PHONY: all clean help

# Rules and targets
all: libs $(EXE)

libs:
	@cd $(LIBELF_DIR) && $(MAKE)

$(EXE): tbt.o
	$(CC) $(CFLAGS) -o $@ $^ $(LIBELF) $(LDFLAGS)

tbt.o : tbt.c tbt.h $(LIBELF_DIR)/elf.h
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $<

clean:
	@rm -f *~ *.o $(EXE)
	@cd $(LIBELF_DIR) && $(MAKE) clean

help:
	@echo "Usage:"
	@echo "  make [all]\t\tBuild the software"
	@echo "  make clean\t\tRemove all files generated by make"
	@echo "  make help\t\tDisplay this help"
